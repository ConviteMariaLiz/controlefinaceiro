<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minhas Economias - Controle Financeiro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f0fdf4; color: #1f2937; }
        .card { background: white; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); padding: 24px; margin-bottom: 20px; }
        .btn-green { background-color: #16a34a; color: white; padding: 12px 24px; border-radius: 8px; border: none; cursor: pointer; font-weight: 600; transition: 0.3s; }
        .btn-green:hover { background-color: #15803d; }
        .btn-add { background-color: #16a34a; color: white; padding: 10px 14px; border-radius: 50%; border: none; cursor: pointer; font-size: 18px; }
        .progress-bar { background-color: #e5e7eb; border-radius: 4px; height: 8px; overflow: hidden; }
        .progress-fill { background-color: #16a34a; height: 100%; transition: width 0.3s; }
        .hidden { display: none; }
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 1000; }
        .modal-content { background: white; padding: 24px; border-radius: 12px; max-width: 500px; width: 90%; }
    </style>
</head>
<body class="min-h-screen">

    <header class="bg-green-600 text-white py-6 text-center">
        <h1 class="text-3xl font-bold"><i class="fas fa-wallet"></i> Minhas Economias</h1>
        <p class="mt-2">Controle suas finanças e alcance suas metas</p>
    </header>

    <nav class="bg-white shadow-md py-4 sticky top-0 z-50">
        <div class="container mx-auto flex justify-center space-x-2 md:space-x-6">
            <button onclick="showSection('dashboard')" class="px-3 py-2 text-green-600 font-semibold hover:bg-green-100 rounded">Dashboard</button>
            <button onclick="showSection('entradas')" class="px-3 py-2 text-green-600 font-semibold hover:bg-green-100 rounded">Entradas</button>
            <button onclick="showSection('saidas')" class="px-3 py-2 text-green-600 font-semibold hover:bg-green-100 rounded">Saídas</button>
            <button onclick="showSection('metas')" class="px-3 py-2 text-green-600 font-semibold hover:bg-green-100 rounded">Metas</button>
        </div>
    </nav>

    <main class="container mx-auto p-6 max-w-6xl">
        <div id="dashboard" class="section">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                <div class="card text-center">
                    <h3 class="text-sm font-semibold text-gray-500 uppercase">Saldo Atual</h3>
                    <p id="saldo-geral" class="text-3xl font-bold text-green-600">R$ 0,00</p>
                </div>
                <div class="card text-center">
                    <h3 class="text-sm font-semibold text-gray-500 uppercase">Receitas</h3>
                    <p id="total-entradas" class="text-3xl font-bold text-blue-600">R$ 0,00</p>
                </div>
                <div class="card text-center">
                    <h3 class="text-sm font-semibold text-gray-500 uppercase">Despesas</h3>
                    <p id="total-saidas" class="text-3xl font-bold text-red-600">R$ 0,00</p>
                </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="card">
                    <h3 class="font-bold mb-4">Gastos por Categoria</h3>
                    <canvas id="chartCategorias"></canvas>
                </div>
                <div class="card">
                    <h3 class="font-bold mb-4">Progresso das Metas</h3>
                    <div id="lista-metas-dash"></div>
                </div>
            </div>
        </div>

        <div id="entradas" class="section hidden">
            <div class="card">
                <h2 class="text-xl font-bold mb-4">Nova Receita</h2>
                <form onsubmit="adicionarTransacao(event, 'entrada')">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <input type="number" step="0.01" id="val-entrada" placeholder="Valor R$" class="p-3 border rounded" required>
                        <input type="text" id="desc-entrada" placeholder="Fonte (ex: Salário)" class="p-3 border rounded" required>
                        <input type="date" id="data-entrada" class="p-3 border rounded" required>
                    </div>
                    <button type="submit" class="btn-green mt-4 w-full">Salvar Entrada</button>
                </form>
            </div>
            <div class="card">
                <h3 class="font-bold mb-4">Histórico de Receitas</h3>
                <ul id="lista-entradas" class="divide-y"></ul>
            </div>
        </div>

        <div id="saidas" class="section hidden">
            <div class="card">
                <h2 class="text-xl font-bold mb-4">Nova Despesa</h2>
                <form onsubmit="adicionarTransacao(event, 'saida')">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <input type="number" step="0.01" id="val-saida" placeholder="Valor R$" class="p-3 border rounded" required>
                        <select id="cat-saida" class="p-3 border rounded"></select>
                        <input type="text" id="nova-cat" placeholder="Ou digite nova categoria" class="p-3 border rounded">
                        <input type="date" id="data-saida" class="p-3 border rounded" required>
                    </div>
                    <button type="submit" class="btn-green mt-4 w-full">Salvar Saída</button>
                </form>
            </div>
            <div class="card">
                <h3 class="font-bold mb-4">Histórico de Gastos</h3>
                <ul id="lista-saidas" class="divide-y"></ul>
            </div>
        </div>

        <div id="metas" class="section hidden">
            <div class="card">
                <h2 class="text-xl font-bold mb-4">Criar Meta de Economia</h2>
                <form onsubmit="adicionarMeta(event)">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <input type="text" id="meta-nome" placeholder="Nome da Meta (ex: Viagem)" class="p-3 border rounded" required>
                        <input type="number" id="meta-valor" placeholder="Valor Objetivo R$" class="p-3 border rounded" required>
                    </div>
                    <button type="submit" class="btn-green mt-4 w-full">Criar Meta</button>
                </form>
            </div>
            <div id="grid-metas" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
        </div>
    </main>

    <script>
        // --- BANCO DE DADOS LOCAL ---
        let dados = JSON.parse(localStorage.getItem('financas_db')) || {
            transacoes: [],
            metas: [],
            categorias: ['Alimentação', 'Transporte', 'Lazer', 'Saúde', 'Casa']
        };

        let meuGrafico = null;

        // --- FUNÇÕES DE NAVEGAÇÃO ---
        function showSection(id) {
            document.querySelectorAll('.section').forEach(s => s.classList.add('hidden'));
            document.getElementById(id).classList.remove('hidden');
            if(id === 'dashboard') atualizarDashboard();
        }

        // --- LÓGICA DE TRANSAÇÕES ---
        function adicionarTransacao(e, tipo) {
            e.preventDefault();
            const valor = parseFloat(document.getElementById(`val-${tipo}`).value);
            const data = document.getElementById(`data-${tipo}`).value;
            let categoria = "";

            if(tipo === 'entrada') {
                categoria = document.getElementById('desc-entrada').value;
            } else {
                const sel = document.getElementById('cat-saida').value;
                const nova = document.getElementById('nova-cat').value;
                categoria = nova || sel;
                if(nova && !dados.categorias.includes(nova)) dados.categorias.push(nova);
            }

            dados.transacoes.push({ id: Date.now(), tipo, valor, categoria, data });
            salvar();
            e.target.reset();
            alert("Registrado com sucesso!");
            renderizarListas();
        }

        function adicionarMeta(e) {
            e.preventDefault();
            const nome = document.getElementById('meta-nome').value;
            const objetivo = parseFloat(document.getElementById('meta-valor').value);
            dados.metas.push({ id: Date.now(), nome, objetivo });
            salvar();
            e.target.reset();
            renderizarMetas();
        }

        function deletar(id) {
            dados.transacoes = dados.transacoes.filter(t => t.id !== id);
            salvar();
            renderizarListas();
            atualizarDashboard();
        }

        // --- CÁLCULOS E RENDERIZAÇÃO ---
        function salvar() {
            localStorage.setItem('financas_db', JSON.stringify(dados));
            popularCategorias();
        }

        function popularCategorias() {
            const select = document.getElementById('cat-saida');
            select.innerHTML = dados.categorias.map(c => `<option value="${c}">${c}</option>`).join('');
        }

        function renderizarListas() {
            const listaE = document.getElementById('lista-entradas');
            const listaS = document.getElementById('lista-saidas');
            
            listaE.innerHTML = dados.transacoes.filter(t => t.tipo === 'entrada').map(t => `
                <li class="py-3 flex justify-between items-center">
                    <div><b>${t.categoria}</b><br><small>${t.data}</small></div>
                    <div class="text-blue-600 font-bold">R$ ${t.valor.toFixed(2)} 
                    <button onclick="deletar(${t.id})" class="ml-2 text-gray-400 hover:text-red-500"><i class="fas fa-trash"></i></button></div>
                </li>
            `).join('');

            listaS.innerHTML = dados.transacoes.filter(t => t.tipo === 'saida').map(t => `
                <li class="py-3 flex justify-between items-center">
                    <div><b>${t.categoria}</b><br><small>${t.data}</small></div>
                    <div class="text-red-600 font-bold">- R$ ${t.valor.toFixed(2)}
                    <button onclick="deletar(${t.id})" class="ml-2 text-gray-400 hover:text-red-500"><i class="fas fa-trash"></i></button></div>
                </li>
            `).join('');
        }

        function renderizarMetas() {
            const container = document.getElementById('grid-metas');
            const dashContainer = document.getElementById('lista-metas-dash');
            const saldoTotal = calcularSaldo();

            const html = dados.metas.map(m => {
                const progresso = Math.min((saldoTotal / m.objetivo) * 100, 100).toFixed(0);
                return `
                    <div class="card">
                        <div class="flex justify-between mb-2">
                            <span class="font-bold">${m.nome}</span>
                            <span>R$ ${saldoTotal.toFixed(2)} / ${m.objetivo}</span>
                        </div>
                        <div class="progress-bar"><div class="progress-fill" style="width: ${progresso}%"></div></div>
                        <p class="text-right text-xs mt-1">${progresso}% alcançado</p>
                    </div>
                `;
            }).join('');
            
            container.innerHTML = html;
            dashContainer.innerHTML = html || '<p class="text-gray-400">Nenhuma meta cadastrada.</p>';
        }

        function calcularSaldo() {
            const ent = dados.transacoes.filter(t => t.tipo === 'entrada').reduce((a, b) => a + b.valor, 0);
            const sai = dados.transacoes.filter(t => t.tipo === 'saida').reduce((a, b) => a + b.valor, 0);
            return ent - sai;
        }

        function atualizarDashboard() {
            const receitas = dados.transacoes.filter(t => t.tipo === 'entrada').reduce((a, b) => a + b.valor, 0);
            const despesas = dados.transacoes.filter(t => t.tipo === 'saida').reduce((a, b) => a + b.valor, 0);
            
            document.getElementById('saldo-geral').innerText = `R$ ${(receitas - despesas).toLocaleString('pt-BR')}`;
            document.getElementById('total-entradas').innerText = `R$ ${receitas.toLocaleString('pt-BR')}`;
            document.getElementById('total-saidas').innerText = `R$ ${despesas.toLocaleString('pt-BR')}`;

            renderizarMetas();
            renderizarGrafico();
        }

        function renderizarGrafico() {
            const ctx = document.getElementById('chartCategorias').getContext('2d');
            const gastos = {};
            dados.transacoes.filter(t => t.tipo === 'saida').forEach(t => {
                gastos[t.categoria] = (gastos[t.categoria] || 0) + t.valor;
            });

            if(meuGrafico) meuGrafico.destroy();
            
            meuGrafico = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(gastos),
                    datasets: [{
                        data: Object.values(gastos),
                        backgroundColor: ['#16a34a', '#3b82f6', '#ef4444', '#f59e0b', '#8b5cf6']
                    }]
                },
                options: { responsive: true }
            });
        }

        // Inicialização
        popularCategorias();
        renderizarListas();
        atualizarDashboard();

    </script>
</body>
</html>
